<!DOCTYPE HTML>
<html>
    <head>
        <title>test</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script tyoe="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.4/socket.io.js"></script>
        <script type="text/javascript">
            $(document).ready(function() {
                var reader = new FileReader();
                reader.addEventListener('load', function(){
                    $("#result").html('<img src="'+reader.result+'">');
                });

                if (window.File && window.FileReader) {
                    console.log("File API is available");
                }else{console.log("File API is NOT available");}

                namespace = '/test';
                //var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port + namespace);
                var socket = io('http://127.0.0.1:5000' + namespace);
                console.log(socket);
                socket.on('connect', function() {
                    console.log("connect");
                    socket.emit('my_event', {data: "connected"});
                });
                socket.on('my_response', function(msg) {
                    $("#log").append('<br>' + $('<div/>').text('Received: ' + msg.data).html());
                });

                $('form#emit').submit(function(event) {
                    console.log("pushed");
                    socket.emit('my_event', {data: $('#emit_data').val()});
                    return false;
                });
                $('#image_data').change(function(){
                    console.log(this.files[0]);
                    reader.readAsDataURL(this.files[0]);
                });
                $("form#image").submit(function(event) {
                    console.log(reader.result);
                    socket.emit('my_image', {data: reader.result});
                    return false;
                });
            });
        </script>
        <style type="text/css">
        img {
            width: 30%
        }
        </style>
    </head>
    <body>
        <form id="emit" method="POST" action='#'>
            <input type="text" name="emit_data" id="emit_data" placeholder="Message">
            <input type="submit" value="Echo">
        </form>
        <form id="image" method="POST" action="#" enctype="multipart/form-data">
            <input multiple type="file" name="image_data" id="image_data" placeholder="ファイルを選択してください" accept="image/jpeg">
            <input type="submit" value="Send">
            <div id="result"></div>
        </form>
        <div id="log"></div>
    </body>
</html>